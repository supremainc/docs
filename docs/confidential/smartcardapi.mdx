---
id: smartcardapi
title: 슈프리마 스마트 카드 발급 안내
toc_max_heading_level: 3
heading_className: confidential
---

import TypedefStruct from '@site/src/components/TypedefStruct';

이 문서는 서드파티 업체가 슈프리마의 BioStar 플랫폼과 호환되는 스마트 카드를 발급하기 위한 기술 가이드입니다.

* **카드 데이터 구조**: SCC(Secure Credential Card)와 AOC(Access on Card) 제작에 필요한 데이터 구조

* **구조체 명세**: 카드 제작 시 준수해야 하는 필드별 상세 요구사항

* **데이터 무결성**: CRC 검증을 통한 카드 데이터 품질 보장 방법

* **구현 참조**: 각 구조체 간의 관계와 올바른 데이터 설정 방법

이 문서에 따라 제작된 스마트 카드는 슈프리마의 모든 BioStar 호환 장치에서 정상 동작합니다.

:::info

스마트 카드를 발급하기 전에 아래 사항을 확인하세요.

* **SDK 요구 사항**: [BioStar 2 Device SDK](https://kb.supremainc.com/bs2sdk)

* **호환 장치**: BioStar 지원 모든 슈프리마 장치

* **카드 유형**: SCC(Secure Credential Card), AOC(Access on Card)

:::

## 구조체 관계도

<map id="imgmap2025813133616" name="imgmap2025813133616">
<area shape="rect" title="BS2Card" coords="22,217,190,319" href="#bs2card" />
<area shape="rect" title="BS2SmartCardData" coords="271,281,539,424" href="#bs2smartcarddata" />
<area shape="rect" title="BS2SmartCardHeader" coords="621,36,888,337" href="#bs2smartcardheader" />
<area shape="rect" title="BS2SmartCardCredentials" coords="621,363,888,482" href="#bs2smartcardcredentials" />
<area shape="rect" title="BS2AcessOnCardData" coords="621,508,888,640" href="#bs2accessoncarddata" />
</map>
<Image src='/img/common/smartcardapi-structure.png' className='useMap' usemap="#imgmap2025813133616" />

:::note

이미지의 구조체를 클릭하면 해당 구조체의 상세 정보로 이동합니다.

:::

<div className='page-break' />

## 구조체

<TypedefStruct 
  name="BS2SmartCardHeader"
  description="SmartCard 헤더 정보를 담는 구조체입니다."
  category="Smart Card"
  size="16"
  hierarchy={[
    {
      name: "BS2SmartCardHeader",
      type: "struct",
      size: 16,
      description: "SmartCard 헤더 구조체",
      children: [
        {
          name: "체크섬 영역",
          description: "체크섬 영역은 카드 데이터의 무결성을 검증하는 데 사용합니다. 자세한 내용은 <a href='#crc'>다음 문서</a>를 참고하세요.",
          children: [
            { name: "hdrCRC", type: "uint16_t", size: 2, description: "카드 헤더 체크섬 값입니다. (cardCRC - reserved)" },
            { name: "cardCRC", type: "uint16_t", size: 2, description: "카드 데이터 체크섬 값입니다. (<code>BS2SmartCardHeader.cardType</code> - <code>BS2SmartCardData.accessOnData</code>)" }
          ]
        },
        {
          name: "카드 메타데이터",
          description: "카드 유형 및 템플릿 정보",
          children: [
            { name: "cardType", type: "BS2_CARD_TYPE", size: 1, description: "카드 유형의 코드 값입니다.",
              constants: [
              { value: "0x02", description: "Secure Credential Card (SCC)" },
              { value: "0x03", description: "Access on Card (AOC)" }
            ]},
            { 
              name: "numOfTemplate", 
              type: "uint8_t", 
              size: 1, 
              description: "지문 템플릿의 개수입니다. Access on Card (AOC) 카드 구조상 템플릿은 <code>BS2SmartCardCredentials</code>에 저장됩니다. 지문 또는 얼굴을 선택적으로 저장해야 합니다. 지문과 얼굴이 함께 저장되지 않으므로 AOC 카드에 지문 템플릿을 저장하려면, <code>numOfFaceTemplate</code>은 반드시 <code>0</code>으로 설정되어야 합니다.",
              notes: ["최대 4개의 지문 템플릿을 지원합니다. 지문 템플릿 데이터 영역에 대한 자세한 내용은 <a href='#bs2smartcardcredentials'>다음 문서</a>를 참고하세요."],
            },
            { name: "templateSize", 
              type: "uint16_t", 
              size: 2, 
              description: "지문 템플릿의 크기입니다. 일반적인 지문 템플릿의 크기는 384바이트로 고정되어 있습니다. BioStar 2에서 스마트 카드를 사용하려면 기본값은 300바이트이며, 필요에 따라 변경할 수 있지만 템플릿의 크기가 너무 작게 설정되면 지문 매칭에 문제가 발생할 수 있으므로 300바이트 이상으로 설정하는 것을 권장합니다.",
              notes: [
                "300바이트로 설정 시 384바이트 크기의 배열에 300바이트를 복사하고 나머지 84바이트는 0으로 패딩해야 합니다.",
                "Mifare 1K Classic 카드에 2개의 지문을 저장하려면 각 템플릿을 300바이트로 설정해야 합니다."
              ]
            },
            {
              name: "issueCount", type: "uint16_t", size: 2, description: "스마트 카드 발급 회차입니다. 카드 ID와 발급 회차를 조합하여 블랙리스트를 관리하므로 발급 회차를 정확히 관리해야 합니다. 카드 재발급 시 발급 회차를 1씩 증가시켜야 합니다."
            },
            {
              name: "duressMask",
              type: "uint8_t",
              size: 1,
              description: "협박 지문 유무 마스크 값입니다."
            },
            { name: "numOfFaceTemplate", type: "uint8_t", size: 1, description: "얼굴 템플릿 수를 나타냅니다. 지문과 얼굴이 갖는 기본 템플릿(지문:384, 얼굴:552)의 크기가 다르지만, 이 경우에도 변함없이 <code>BS2SmartCardCredentials</code>의 <code>templateData</code>의 전체 크기를 고려하여 저장하면 됩니다. AOC 카드 구조 상 템플릿은 <code>BS2SmartCardCredentials</code>에 저장됩니다. 그리고 여기에는 지문 또는 얼굴을 선택적으로 저장해야 합니다. 지문과 얼굴이 함께 저장되지 않으므로 AOC 카드에 얼굴 템플릿을 저장하려면, <code>numOfTemplate</code>은 반드시 <code>0</code>으로 설정되어야 합니다.",
            notes: [
              "최대 1개의 얼굴 템플릿을 지원합니다."
            ] },
            {
              name: "reserved",
              type: "uint8_t[1]",
              size: 1,
              description: "예약된 공간입니다."
            }
          ]
        },
        {
          name: "인증 설정",
          description: "카드 인증 모드 및 옵션",
          children: [
            { name: "cardAuthMode", type: "uint8_t", size: 1, description: "개인 인증 모드로 장치에 설정된 인증 모드가 아닌 카드에 저장된 인증 모드를 사용하게 됩니다.", 
            notes: [
              "<b>Visual Face</b> 기반은 <code>cardAuthModeEx</code>를 사용하세요."
            ],
            constants: [
              { value: "2", description: "카드 인증만 사용" },
              { value: "3", description: "카드와 지문 인증 사용" },
              { value: "4", description: "카드와 PIN 인증 사용" },
              { value: "5", description: "카드 인증 후 지문이나 PIN 인증 사용" },
              { value: "6", description: "카드, 지문, PIN 인증 사용" },
              { value: "254", description: "사용할 수 없음" },
              { value: "255", description: "정의되지 않음(시스템에 정의된 모드로 동작)" }
            ]},
            { name: "cardAuthModeEx", 
              type: "uint8_t", 
              size: 1, 
              description: "<span class='badge'>SDK v2.7.1 or later</span> <b>Visual Face</b> 기반 카드 인증 모드 설정값입니다. 개인 인증 모드로 장치에 설정된 인증 모드가 아닌 카드에 저장된 인증 모드를 사용하게 됩니다.",
              notes: [
                "슈프리마 장치는 FaceStation F2, BioStation 3, BioEntry W3 모델에서 지원합니다.",
                "모든 장치에 일관되게 적용하려면 <code>cardAuthMode</code>, <code>cardAuthModeEx</code> 모두를 설정해야 합니다. 지원하는 장치를 확인하세요."
              ],
              constants: [
                { value: "21", description: "카드" },
                { value: "22", description: "카드 + 얼굴" },
                { value: "23", description: "카드 + 지문" },
                { value: "24", description: "카드 + PIN" },
                { value: "26", description: "카드 + 얼굴 또는 PIN" },
                { value: "27", description: "카드 + 지문 또는 PIN" },
                { value: "28", description: "카드 + 얼굴 또는 지문 또는 PIN" },
                { value: "30", description: "카드 + 얼굴 + PIN" },
                { value: "32", description: "카드 + 지문 + PIN" },
                { value: "33", description: "카드 + 얼굴 또는 지문 + PIN" },
                { value: "254", description: "사용할 수 없음" },
                { value: "255", description: "정의되지 않음(시스템 정의 모드)" }
              ]
            },
            { name: "useAlphanumericID", type: "uint8_t", size: 1, description: "영숫자(Alphanumeric) ID를 사용할지 결정하는 플래그(flag)입니다." }
          ]
        }
      ]
    }
  ]}
  dependencies={[
    { name: "BS2_CARD_TYPE", type: "enum", description: "카드 타입 열거형" }
  ]}
  usedBy={[
    { name: "BS2SmartCardData", type: "struct", description: "SmartCard 데이터 구조체" }
  ]}
/>

<TypedefStruct 
  name="BS2SmartCardCredentials"
  description="PIN 코드와 생체 인식 템플릿을 저장하는 구조체입니다."
  category="Credentials"
  size="1568"
  hierarchy={[
    {
      name: "BS2SmartCardCredentials",
      type: "struct", 
      size: 1568,
      description: "인증 정보 저장 구조체",
      children: [
        {
          name: "pin",
          type: "uint8_t[BS2_PIN_HASH_SIZE]",
          size: 32,
          description: "PIN 코드 해시값입니다. PIN 코드를 직접 해시하지 말고 BioStar 2 SDK의 해시 함수를 사용하여 장치와 동일한 해시 알고리즘으로 생성해야 합니다."
        },
        {
          name: "templateData",
          type: "uint8_t[S2_SMART_CARD_MAX_TEMPLATE_COUNT * BS2_FINGER_TEMPLATE_SIZE]", 
          size: 1536,
          description: "지문 또는 얼굴 템플릿 데이터 영역으로 최대 4개의 지문 템플릿, 최대 1개의 얼굴 템플릿을 저장할 수 있습니다.",
          children: [
            { name: "Template 1", type: "uint8_t[384]", size: 384, description: "첫 번째 템플릿" },
            { name: "Template 2", type: "uint8_t[384]", size: 384, description: "두 번째 템플릿" },
            { name: "Template 3", type: "uint8_t[384]", size: 384, description: "세 번째 템플릿" },
            { name: "Template 4", type: "uint8_t[384]", size: 384, description: "네 번째 템플릿" }
          ]
        }
      ]
    }
  ]}
  constants={[
    { value: "BS2_PIN_HASH_SIZE", description: "PIN 해시 크기", note: "32바이트" },
    { value: "BS2_SMART_CARD_MAX_TEMPLATE_COUNT", description: "최대 템플릿 개수", note: "4개" },
    { value: "BS2_FINGER_TEMPLATE_SIZE", description: "지문 템플릿 크기", note: "384바이트" }
  ]}
  usedBy={[
    { name: "BS2SmartCardData", type: "struct", description: "SmartCard 데이터 구조체" }
  ]}
/>

<TypedefStruct 
  name="BS2AccessOnCardData"
  description="AOC 카드의 출입 권한 정보를 저장하는 구조체입니다."
  category="Access Control"
  size="40"
  hierarchy={[
    {
      name: "BS2AccessOnCardData",
      type: "struct",
      size: 40,
      description: "출입 권한 정보 구조체",
      children: [
        {
          name: "accessGroupID",
          type: "uint16_t[BS2_SMART_CARD_MAX_ACCESS_GROUP_COUNT]",
          size: 32,
          description: "출입 그룹 ID 리스트입니다. 각 그룹은 1부터 65535까지의 ID를 가질 수 있으며, 최대 16개의 그룹을 지원합니다.",
          children: [
            { name: "Group ID 1", type: "uint16_t", size: 2, description: "첫 번째 출입 그룹" },
            { name: "Group ID 2", type: "uint16_t", size: 2, description: "두 번째 출입 그룹" },
            { name: "...", type: "uint16_t", size: 2, description: "..." },
            { name: "Group ID 16", type: "uint16_t", size: 2, description: "마지막 출입 그룹" }
          ]
        },
        {
          name: "시간 제한",
          description: "출입 가능 시간 범위입니다.",
          children: [
            { name: "startTime", type: "BS2_DATETIME", size: 4, description: "사용자 인증이 가능한 시작 시간이며, <code>0</code>일 경우 제한이 없습니다. Unix timestamp 형식으로 초 단위입니다." },
            { name: "endTime", type: "BS2_DATETIME", size: 4, description: "사용자 인증이 가능한 마지막 시간이며, <code>0</code>일 경우 제한이 없습니다. Unix timestamp 형식으로 초 단위입니다." }
          ]
        }
      ]
    }
  ]}
  constants={[
    { value: "BS2_SMART_CARD_MAX_ACCESS_GROUP_COUNT", description: "최대 출입 그룹 개수", note: "16개" }
  ]}
  dependencies={[
    { name: "BS2_DATETIME", type: "typedef", description: "날짜/시간 타입" }
  ]}
  usedBy={[
    { name: "BS2SmartCardData", type: "struct", description: "SmartCard 데이터 구조체" }
  ]}
/>

<TypedefStruct 
  name="BS2SmartCardData"
  description="SmartCard의 모든 데이터를 포함하는 복합 구조체입니다."
  category="Smart Card"
  size="1656"
  hierarchy={[
    {
      name: "BS2SmartCardData",
      type: "composite struct",
      size: 1656,
      description: "SmartCard 전체 데이터 컨테이너",
      children: [
        {
          name: "header",
          type: "BS2SmartCardHeader",
          size: 16,
          description: "SmartCard 헤더입니다.",
          references: ["BS2SmartCardHeader"]
        },
        {
          name: "cardID",
          type: "uint8_t[BS2_CARD_DATA_SIZE]",
          size: 32,
          description: "단말기에서 사용할 카드 식별자입니다. <b>Access on Card(AOC)</b>는 배열의 32byte를 Card ID로 사용하고, <b>Secure Credential Card(SCC)</b>는 배열의 24byte를 Card ID로 사용합니다. <b>Secure Credential Card(SCC)</b>는 32byte를 Card ID(24 bytes)로, issueCount(4byte) 그리고 Time Stamp(4byte)로 채워져야 합니다. 또한, <code>BS2UserBlob</code> 구조체의 cardObjs array가 SC Card로 채워야 하며, SC Card 발급 시마다 <code>cardObjs</code>를 업데이트해야 합니다.",
          children: [
            { name: "cardID: Access on Card(AOC)", type: "bytes[0-31]", size: 32, description: "AOC: 전체 32바이트 사용" },
            { name: "cardID: Secure Credential Card(SCC)", 
              type: "bytes[0-31]", 
              size: 32,
              description: "SCC: 카드 ID(32바이트)",
              children: [
                { name: "cardID (SCC)", type: "bytes[0-23]", size: 24, description: "SCC: 카드 ID(24바이트)" },
                { name: "issueCount (SCC)", type: "bytes[24-27]", size: 4, description: "SCC: 발급 횟수" },
                { name: "timeStamp (SCC)", type: "bytes[28-31]", size: 4, description: "SCC: 발급 시간" }
              ]
            },
          ]
        },
        {
          name: "credentials",
          type: "BS2SmartCardCredentials",
          size: 1568,
          description: "PIN 코드나 지문 템플릿이 저장되어 있는 인증 데이터 영역입니다.",
          references: ["BS2SmartCardCredentials"]
        },
        {
          name: "accessOnData",
          type: "BS2AccessOnCardData",
          size: 40,
          description: "AOC 카드에서 사용하는 영역으로 출입 그룹 정보를 가지고 있습니다.",
          references: ["BS2AccessOnCardData"]
        }
      ]
    }
  ]}
  dependencies={[
    { name: "BS2SmartCardHeader", type: "struct", description: "SmartCard 헤더" },
    { name: "BS2SmartCardCredentials", type: "struct", description: "인증 정보" },
    { name: "BS2AccessOnCardData", type: "struct", description: "출입 권한 데이터" },
    { name: "BS2_CARD_DATA_SIZE", type: "constant", description: "카드 데이터 크기 상수(32)" }
  ]}
  usedBy={[
    { name: "BS2Card", type: "union", description: "카드 타입 래퍼" }
  ]}
/>

<TypedefStruct 
  name="BS2Card"
  description="모든 카드 타입을 포괄하는 최상위 구조체입니다."
  category="Core Structure"
  size="1657"
  hierarchy={[
    {
      name: "BS2Card",
      type: "union wrapper",
      size: 1657,
      description: "카드 타입 식별 및 데이터 저장",
      children: [
        {
          name: "isSmartCard",
          type: "uint8_t",
          size: 1,
          description: "SmartCard 여부를 나타내는 플래그(flag)입니다.",
          constants: [
            { value: "1", description: "SmartCard (<code>BS2SmartCardData</code> 사용)" }
          ]
        },
        {
          name: "Union 데이터",
          description: "카드 타입별 데이터",
          children: [
            {
              name: "smartCard",
              type: "BS2SmartCardData",
              size: 1656,
              description: "SmartCard 데이터입니다. <code>isSmartCard</code>가 <code>1</code>일 때 사용합니다.",
              references: ["BS2SmartCardData"]
            }
          ]
        }
      ]
    }
  ]}
  dependencies={[
    { name: "BS2SmartCardData", type: "struct", description: "SmartCard 데이터 구조체" }
  ]}
/>


## CRC 계산 및 검증 {#crc}

SmartCard 데이터의 무결성을 보장하기 위해 헤더와 카드 데이터에 각각 CRC-16 CCITT 체크섬(`hdrCRC`, `cardCRC`)을 사용합니다.

### hdrCRC, cardCRC란? {#hdrcrc-cardcrc}

- `hdrCRC`: `BS2SmartCardHeader`의 `cardCRC`부터 `reserved`까지(총 14바이트)에 대해 CRC-16 CCITT(다항식 0x1021, 초기값 0xFFFF)로 계산한 값입니다.
- `cardCRC`: `cardType`부터 `BS2SmartCardData.accessOnData`까지(헤더를 제외한 카드 데이터 전체)에 대해 CRC-16 CCITT(다항식 0x1021, 초기값 0xFFFF)로 계산한 값입니다.

### CRC 계산 방법 {#crc-calculation}

[BioStar 2 SDK](https://kb.supremainc.com/bs2sdk/doku.php)에서는 **BS2_ComputeCRC16CCITT** 함수를 제공합니다. 아래는 사용 예시입니다.

```csharp title='Calculate checksum'
// Calculate card data checksum (cardCRC)
uint16_t cardCRC = 0xFFFF;
int result = BS2_ComputeCRC16CCITT((uint8_t*)&card.header.cardType, sizeof(BS2SmartCardData) - offsetof(BS2SmartCardHeader, cardType), &cardCRC);

// Calculate header checksum (hdrCRC)
card.header.cardCRC = cardCRC;  // Set the cardCRC value first
uint16_t hdrCRC = 0xFFFF;
result = BS2_ComputeCRC16CCITT((uint8_t*)&card.header.cardCRC, sizeof(BS2SmartCardHeader) - offsetof(BS2SmartCardHeader, cardCRC), &hdrCRC);
```

:::note

- `cardCRC`는 `cardType`부터 `accessOnData`까지 계산합니다.

- `hdrCRC`는 `cardCRC`부터 `reserved`까지 계산합니다.

- 반드시 `cardCRC`를 먼저 계산한 후 헤더에 설정하고, 그 다음 `hdrCRC`를 계산해야 합니다.

:::


### 검증 방법 {#crc-validation}

카드 데이터를 읽을 때 무결성을 검증하려면 다음과 같이 수행하세요.

1. 카드에서 읽은 데이터로 CRC 재계산

1. 저장된 CRC 값과 계산된 CRC 값 비교

```csharp title='CRC Validation'
// CRC validation example
BS2SmartCardData readCard;  // Data read from card

// 1. cardCRC validation
uint16_t calculatedCardCRC = 0xFFFF;
BS2_ComputeCRC16CCITT((uint8_t*)&readCard.header.cardType, sizeof(BS2SmartCardData) - offsetof(BS2SmartCardHeader, cardType), &calculatedCardCRC);

if (readCard.header.cardCRC != calculatedCardCRC) {
    // Card data corruption
    return ERROR_CARD_DATA_CORRUPTED;
}

// 2. hdrCRC validation
uint16_t calculatedHdrCRC = 0xFFFF;
BS2_ComputeCRC16CCITT((uint8_t*)&readCard.header.cardCRC, sizeof(BS2SmartCardHeader) - offsetof(BS2SmartCardHeader, cardCRC), &calculatedHdrCRC);

if (readCard.header.hdrCRC != calculatedHdrCRC) {
    // Header data corruption
    return ERROR_HEADER_DATA_CORRUPTED;
}
```

:::note

**CRC 계산 시 주의사항**

* **계산 순서**: 반드시 `cardCRC`를 먼저 계산한 후 헤더에 설정하고, 그 다음 `hdrCRC`를 계산해야 합니다.

* **구조체 정렬**: CRC 계산 범위가 정확히 일치해야 하며, 구조체 패딩이나 정렬에 주의하세요.

* **초기값**: CRC-16 CCITT는 0x1021 다항식, **초기값 0xFFFF**를 사용합니다.

* **SDK 함수**: `BS2_ComputeCRC16CCITT` 함수는 [BioStar 2 SDK](https://kb.supremainc.com/bs2sdk/doku.php)에서 제공됩니다.

* **데이터 순서**: 입력 데이터는 바이트 단위 Little Endian으로 처리됩니다.

:::